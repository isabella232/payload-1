# frozen_string_literal: true
# <!-- BEGIN AUTOGENERATED ANNOTATIONS -->
# ## Schema Information
#
# Table name: `btc_txes`
#
# ### Columns
#
# Name                       | Type               | Attributes
# -------------------------- | ------------------ | ---------------------------
# **`id`**                   | `integer`          | `not null, primary key`
# **`btc_address_id`**       | `integer`          |
# **`amount`**               | `decimal(16, 8)`   |
# **`confirmation_status`**  | `integer`          |
# **`coinbase_id`**          | `string`           |
# **`native_amount`**        | `decimal(, )`      |
# **`native_currency`**      | `integer`          |
# **`created_at`**           | `datetime`         | `not null`
# **`updated_at`**           | `datetime`         | `not null`
#
# ### Indexes
#
# * `index_btc_txes_on_btc_address_id`:
#     * **`btc_address_id`**
#
# ### Foreign Keys
#
# * `fk_rails_f31e8e88ea`:
#     * **`btc_address_id => btc_addresses.id`**
#
# <!-- END AUTOGENERATED ANNOTATIONS -->

class BtcTx < ApplicationRecord
  belongs_to :btc_address
  before_validation :set_defaults

  # the status of the transaction
  # pending: not confirmed on the blockchain yet
  # confirmed: Confirmed on the blockchain but not yet traded
  # processing: Confirmed and traded, but not yet paid out
  # completed: paid out
  enum confirmation_status: %i(pending confirmed processing complete)

  # what currency was this btc exchanged for?
  enum native_currency: %i(pkr usd eur)

  validates :amount, presence: true, numericality: true
  validates :coinbase_id, presence: true
  validates :native_currency, presence: true
  validates :confirmation_status, presence: true

  private

  def set_defaults
    self.native_currency ||= 'pkr'
    self.confirmation_status = 'pending'
  end
end
